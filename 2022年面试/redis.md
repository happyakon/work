## REDIS

### 1.REDIS为什么快？

> 1.基于内存
>
> 2.底层优秀的设计结构
>
> 3.IO多路复用

### 2.什么是IO多路复用？

> 多路复用是指以同一传输媒质（线路）承载多路信号进行通信的方式。在liunx中，一切皆文件，每个socket也对应一个相应的文件描述符，所有的文件描述符封装在一个列表中。，其实就是用一个线程或进程来监视多个文件描述符。
>
> redis其实是封装了4中模式，select、poll、kqueue,epoll,因为redis是多平台的，会根据不同的平台选择不同的模式，在Linux使用的就是epoll。
>
> select模式一共只能监视1024个文件描述符，使用轮训的机制查看文件描述符的状态，epoll比较优秀的是没有1024的限制，并且是事件驱动，当某个FD准备好了之后会触发时间，epoll返回用户的也是准备好的FD，不需要再去遍历，而且数据结构上用了红黑树和链表。这部分是放在内核和用户共用的部分，不用再从用户态到内核态的文件复制。

### 3.REDIS有哪些数据类型，底层数据结构是什么？

> REDIS支持String,hash,set,zset,list无种数据类型，底层数据结构为
>
> 简单动态字符串、
>
> 整数数组、
>
> 字典、
>
> 压缩列表、
>
> 双向链表、
>
> 跳表

### 4.什么是缓存穿透，缓存击穿，缓存雪崩?如何解决？

#### 4.1 缓存穿透

> 缓存穿透是缓存和数据库都不存在数据，而用户不断发起请求，大流量时对于不存在的key频繁访问就给数据库造成了很大的压力，有可能使数据库宕机。
>
> 解决方案：
>
> 1. 接口层增加校验，风控系统限制用户IP
> 2. 使用布隆过滤器

#### 4.2 缓存击穿

> 缓存击穿是缓存中没有数据，数据库有数据，一般都是Key过期了，但这个时候这个key瞬时被大批量访问，把压力带给数据库。
>
> 解决方案：
>
> 1. 加互斥锁，访问缓存不加锁，访问数据库加锁，第一个线程访问完数据库之后，要写入缓存，其他线程就可以继续访问缓存了
> 2. 设置热点数据不过期，这个很难，因为很难判断什么是热点数据。

#### 4.3 缓存雪崩

> 大面积的key同时过期，流量从而进入数据库。
>
> 解决方案：
>
> 1. 随机设置缓存失效时间，避免key同时到期
> 2. 不设置过期时间
> 3. 定时任务，在缓存失效期刷新缓存。

### 5.REDIS如何保证高可用?

#### 5.1 主从复制

> Redis全量复制一般发生在Slave初始化阶段，这时Slave需要将Master上的所有数据都复制一份。具体步骤如下： 
> \- 从服务器连接主服务器，发送SYNC命令； 
> \- 主服务器接收到SYNC命名后，开始执行BGSAVE命令生成RDB文件并使用缓冲区记录此后执行的所有写命令； 
> \- 主服务器BGSAVE执行完后，向所有从服务器发送快照文件，并在发送期间继续记录被执行的写命令； 
> \- 从服务器收到快照文件后丢弃所有旧数据，载入收到的快照； 
> \- 主服务器快照发送完毕后开始向从服务器发送缓冲区中的写命令； 
> \- 从服务器完成对快照的载入，开始接收命令请求，并执行来自主服务器缓冲区的写命令；

![全量复制](D:\gitwork\work\2022年面试\redis\全量复制.png)

#### 5.2 集群搭建

> 可以搭建集群，当一台挂了的时候，会进行选举，在从服务器中选出一台主服务器。
>
> 横向扩展：
>
> 多主多从，每个主保存的数据不一样，一共16384个slot，这样可以增加并发量，设计比较难，如果增删节点比较复杂。

### 6.REDIS如何持久化？

> AOF和RDB
>
> AOF命令的集合，达到上限后会瘦身，就想合并命令，有点就是保存数据多，缺点恢复慢，得一条条执行指令。
>
> RDB是快照文件，相比于AOF来说不会那么频繁的写入，导致服务器宕机的时候，可能损失比较多的数据，但是恢复会很快。

### 7.REDIS的优缺点？

> 快

### 8.redis的使用场景？

> 1. 存储热点数据，减少对数据库的访问
> 2. 分布式锁
> 3. 用户cookie做单点登录
> 4. 

### 9.redis的最大程度的利用？

##### 9.1不花钱：

> 1.从配置层面：比如开启压缩列表，能节约大概18个字节的空间。压缩列表会对数据进行解码和编码，如果列表长度太长的话，那么进行查询或插入的时候，会造成特别大的性能损耗。
>
> 2.代码层面：尽量简化redis的key,只要唯一又能保证我们业务正确的话就可以。
>
> 3.利用字典，如果有比较通用的数据，可以使用索引

9.2花钱：

> 2.增加redis数量，采用多主多从的集群模式，其实就是用钱换空间。缺点就是成本比较大，无论是金钱的投入还是管理的投入都会比较大。